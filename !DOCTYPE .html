<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Planner</title>
<style>
  body {
    font-family: "Hiragino Sans", "Noto Sans JP", sans-serif;
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    background: #fff;
    color: #333;
  }

  h1 { text-align:center; }

  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }

  .profile {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .profile img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #c653c6;
  }

  .tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 15px;
  }

  .tab {
    padding: 8px 20px;
    margin: 0 5px;
    border-radius: 20px;
    cursor: pointer;
    background: #f7f7f7;
  }

  .tab.active {
    background: #f5d9f7;
    color: #c653c6;
    font-weight: bold;
  }

  #calendar-view, #task-view { display:none; }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 15px;
  }

  th, td {
    border: 1px solid #eee;
    padding: 6px;
    text-align: left;
  }

  th { background: #f7f7f7; }

  .complete-btn, .rescue-btn {
    padding: 3px 6px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size:12px;
  }

  .complete-btn { background:#6aa6ff; color:white; }
  .rescue-btn { background:#f5a623; color:white; }

  .complete-btn:hover { background:#4f8ef5; }
  .rescue-btn:hover { background:#e08c1b; }

  #calendar {
    display:grid;
    grid-template-columns: repeat(7,1fr);
    gap: 3px;
  }

  .day {
    border:1px solid #ddd;
    min-height:60px;
    padding:4px;
    position:relative;
    cursor:pointer;
    background:#fdfdfd;
  }

  .day h4 {
    margin:0;
    font-size:14px;
  }

  .tasks-on-day {
    font-size:12px;
    margin-top:2px;
  }

  .add-task input, .add-task button {
    margin:3px 0;
    padding:5px;
    width: 100%;
    box-sizing:border-box;
  }

  .add-task label { font-size:13px; }

  input[type="file"] { padding:3px; }
</style>
</head>
<body>

<h1>ğŸ“… Study Planner</h1>

<div class="header">
  <div class="profile">
    <img id="userProfile" src="https://i.pravatar.cc/100?img=1">
    <input type="file" id="profileFile" accept="image/*">
  </div>
</div>

<div class="tabs">
  <div class="tab active" id="task-tab">ã‚¿ã‚¹ã‚¯</div>
  <div class="tab" id="calendar-tab">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</div>
</div>

<!-- ã‚¿ã‚¹ã‚¯å…¥åŠ› -->
<div id="task-view">
  <div class="add-task">
    <h3>ğŸ“˜ æ–°ã—ã„èª²é¡Œã‚’è¿½åŠ </h3>
    <input type="text" id="taskName" placeholder="èª²é¡Œå">
    <label>äºˆå®šæ—¥æ™‚ï¼š</label>
    <input type="date" id="taskDate">
    <input type="time" id="taskTime">
    <input type="number" id="taskDuration" placeholder="æ‰€è¦æ™‚é–“(åˆ†)">
    <input type="text" id="taskDeadline" placeholder="æœŸé™(ä¾‹:2025-11-15/æ¯æ—¥)">
    <button id="addTaskBtn">ï¼‹ è¿½åŠ </button>
  </div>

  <h3>æœªå®Œäº†ã‚¿ã‚¹ã‚¯</h3>
  <table id="task-table">
    <tr><th>èª²é¡Œå</th><th>äºˆå®š</th><th>æ™‚é–“</th><th>æœŸé™</th><th>æ“ä½œ</th></tr>
  </table>

  <h3>å®Œäº†ã—ãŸèª²é¡Œ</h3>
  <table id="completed-table">
    <tr><th>èª²é¡Œå</th><th>çŠ¶æ…‹</th><th>æ™‚é–“</th><th>æœŸé™</th><th>æ•‘æ¸ˆ</th></tr>
  </table>
</div>

<!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º -->
<div id="calendar-view">
  <div style="text-align:center; margin-bottom:5px;">
    <button id="prevMonth">&lt;</button>
    <span id="currentMonth"></span>
    <button id="nextMonth">&gt;</button>
  </div>
  <div id="calendar"></div>
</div>

<script>
const taskTab = document.getElementById("task-tab");
const calendarTab = document.getElementById("calendar-tab");
const taskView = document.getElementById("task-view");
const calendarView = document.getElementById("calendar-view");

taskTab.addEventListener("click", ()=>{
  taskTab.classList.add("active");
  calendarTab.classList.remove("active");
  taskView.style.display = "block";
  calendarView.style.display = "none";
});

calendarTab.addEventListener("click", ()=>{
  calendarTab.classList.add("active");
  taskTab.classList.remove("active");
  calendarView.style.display = "block";
  taskView.style.display = "none";
  renderCalendar();
});

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒå¤‰æ›´
const profileFile = document.getElementById("profileFile");
const userProfile = document.getElementById("userProfile");
profileFile.addEventListener("change", (e)=>{
  const file = e.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(evt){
      userProfile.src = evt.target.result;
    }
    reader.readAsDataURL(file);
  }
});

// ã‚¿ã‚¹ã‚¯è¿½åŠ 
const addTaskBtn = document.getElementById("addTaskBtn");
const taskTable = document.getElementById("task-table");
const completedTable = document.getElementById("completed-table");
let tasks = [];

addTaskBtn.addEventListener("click", ()=>{
  const name = document.getElementById("taskName").value.trim();
  const date = document.getElementById("taskDate").value;
  const time = document.getElementById("taskTime").value;
  const duration = document.getElementById("taskDuration").value;
  const deadline = document.getElementById("taskDeadline").value;

  if(!name) return alert("èª²é¡Œåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

  const task = {name,date,time,duration,deadline,completed:false};
  tasks.push(task);
  renderTasks();
  renderCalendar();

  // ãƒªã‚»ãƒƒãƒˆ
  document.getElementById("taskName").value = "";
  document.getElementById("taskDate").value = "";
  document.getElementById("taskTime").value = "";
  document.getElementById("taskDuration").value = "";
  document.getElementById("taskDeadline").value = "";
});

function renderTasks(){
  taskTable.innerHTML = '<tr><th>èª²é¡Œå</th><th>äºˆå®š</th><th>æ™‚é–“</th><th>æœŸé™</th><th>æ“ä½œ</th></tr>';
  completedTable.innerHTML = '<tr><th>èª²é¡Œå</th><th>çŠ¶æ…‹</th><th>æ™‚é–“</th><th>æœŸé™</th><th>æ•‘æ¸ˆ</th></tr>';
  tasks.forEach((t,i)=>{
    if(!t.completed){
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${t.name}</td>
                      <td>${t.date||"-"} ${t.time||""}</td>
                      <td>0/${t.duration||"æœªè¨­å®š"}</td>
                      <td>${t.deadline||"-"}</td>
                      <td><button class="complete-btn" data-i="${i}">å®Œäº†</button></td>`;
      taskTable.appendChild(tr);
    }else{
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${t.name}</td>
                      <td>å®Œäº†æ¸ˆ</td>
                      <td>${t.duration||"-"}</td>
                      <td>${t.deadline||"-"}</td>
                      <td><button class="rescue-btn" data-i="${i}">æ•‘æ¸ˆ</button></td>`;
      completedTable.appendChild(tr);
    }
  });
}

// å®Œäº†ãƒ»æ•‘æ¸ˆãƒœã‚¿ãƒ³
taskTable.addEventListener("click",(e)=>{
  if(e.target.classList.contains("complete-btn")){
    const i = e.target.dataset.i;
    tasks[i].completed = true;
    renderTasks();
    renderCalendar();
  }
});
completedTable.addEventListener("click",(e)=>{
  if(e.target.classList.contains("rescue-btn")){
    const i = e.target.dataset.i;
    tasks[i].completed = false;
    renderTasks();
    renderCalendar();
  }
});

// ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
let today = new Date();
let currentMonth = today.getMonth();
let currentYear = today.getFullYear();
const monthNames = ["1æœˆ","2æœˆ","3æœˆ","4æœˆ","5æœˆ","6æœˆ","7æœˆ","8æœˆ","9æœˆ","10æœˆ","11æœˆ","12æœˆ"];
const calendarEl = document.getElementById("calendar");
const currentMonthEl = document.getElementById("currentMonth");

document.getElementById("prevMonth").addEventListener("click", ()=>{
  currentMonth--;
  if(currentMonth<0){ currentMonth=11; currentYear--; }
  renderCalendar();
});
document.getElementById("nextMonth").addEventListener("click", ()=>{
  currentMonth++;
  if(currentMonth>11){ currentMonth=0; currentYear++; }
  renderCalendar();
});

function renderCalendar(){
  calendarEl.innerHTML = "";
  currentMonthEl.textContent = monthNames[currentMonth]+" "+currentYear;

  const firstDay = new Date(currentYear,currentMonth,1).getDay();
  const lastDate = new Date(currentYear,currentMonth+1,0).getDate();

  // ç©ºç™½æ—¥
  for(let i=0;i<firstDay;i++){
    const blank = document.createElement("div");
    blank.classList.add("day");
    calendarEl.appendChild(blank);
  }

  for(let d=1; d<=lastDate; d++){
    const dayDiv = document.createElement("div");
    dayDiv.classList.add("day");
    const dayHeader = document.createElement("h4");
    dayHeader.textContent = d;
    dayDiv.appendChild(dayHeader);

    // ã‚¿ã‚¹ã‚¯è¡¨ç¤º
    const taskList = document.createElement("div");
    taskList.classList.add("tasks-on-day");
    tasks.forEach(t=>{
      if(t.date && !t.completed){
        const taskDate = new Date(t.date);
        if(taskDate.getFullYear()===currentYear && taskDate.getMonth()===currentMonth && taskDate.getDate()===d){
          const taskEl = document.createElement("div");
          taskEl.textContent = t.name;
          taskEl.style.fontSize="12px";
          taskEl.style.background="#d0f0fd";
          taskEl.style.margin="1px 0";
          taskEl.style.padding="1px";
          taskEl.style.borderRadius="3px";
          taskEl.style.cursor="pointer";

          // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã‚¯ãƒªãƒƒã‚¯â†’å®Œäº†
          taskEl.addEventListener("click", ()=>{
            const index = tasks.indexOf(t);
            if(index>-1){
              tasks[index].completed = true;
              renderTasks();
              renderCalendar();
            }
          });

          taskList.appendChild(taskEl);
        }
      }
    });
    dayDiv.appendChild(taskList);
    calendarEl.appendChild(dayDiv);
  }
}

// åˆæœŸè¡¨ç¤º
taskView.style.display = "block";
renderTasks();
renderCalendar();
</script>
</body>
</html>

